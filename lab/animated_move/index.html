<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Kolkturm Viewer 360</title>
    <script type="text/javascript" src="../../jquery/jquery-3.6.0.min.js"></script>
    <!-- <script type="text/javascript" src="jquery/jquery.mousewheel.min.js"></script> -->
    <script type="text/javascript">
        var canvas;
        var ctx;
        var const_speed;
        var vw;
        var vh;

        function init() {
            canvas = $("#ktv").get(0);
            var wrapper = $(canvas).parent();

            vw = $(wrapper).width();
            vh = $(wrapper).height();

            canvas.width = vw;
            canvas.height = vh;

            ctx = canvas.getContext('2d');

            ctx.font = '14px serif';
            ctx.fillText('Const. speed:', 20, 100);
            ctx.fillText('Linear inc/dec speed:', 20, 200);
        }

        function startAnimation() {
            const_speed = setTimeout(f_const_speed, 50, 200, vw - 50, 200);
            setTimeout(f_inc_dev_speed, 50, 200, vw - 50, 200, 0, true);
        }

        function f_const_speed(start, end, cur) {
            ctx.clearRect(170, 70, vw, 60);

            ctx.beginPath();
            ctx.arc(cur, 100, 30, 0, Math.PI * 2, true);
            ctx.fill();

            if (cur < end) {
                setTimeout(f_const_speed, 50, start, end, cur + 10);
            } else {
              console.log("f_const_speed end position: " + cur);
            }
        }

        function f_inc_dev_speed(start, end, cur, speed, acc) {
            ctx.clearRect(170, 170, vw, 60);

            ctx.beginPath();
            ctx.arc(cur, 200, 30, 0, Math.PI * 2, true);
            ctx.fill();

            if (acc) {
              speed += 2;
            } else {
              speed -= 2;
            }

            if (cur >= (start + (end - start)/2)) acc=false;

            if (cur + speed > end) speed = end - cur;

            if (cur < end) {
                setTimeout(f_inc_dev_speed, 50, start, end, cur + speed, speed, acc);
            } else {
              console.log("f_inc_dev_speed end position: " + cur);
            }
        }
    </script>
    <style>
      body, html {
        margin: 0px;
        padding: 0px;
      }

      #wktv {
        height: 100vh;
      }

      #ktv {
        vertical-align: bottom;
      }
    </style>
  </head>
  <body onload="init()">
    <div id="wktv">
      <canvas id="ktv"></canvas>
    </div>
    <button OnClick="startAnimation();" style="position: absolute; top: 20px; left: 20px" type="button">Start</botton>
  </body>
</html>
